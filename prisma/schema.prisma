generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Banner {
  ma_banner  Int       @id @default(autoincrement())
  ma_phim    Int
  hinh_anh   String    @db.VarChar(500)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  updated_at DateTime? @default(now()) @db.Timestamp(0)
  Phim       Phim      @relation(fields: [ma_phim], references: [ma_phim], onDelete: Cascade, onUpdate: NoAction, map: "Banner_ibfk_1")

  @@index([ma_phim], map: "ma_phim")
}

model Phim {
  ma_phim         Int         @id @default(autoincrement())
  ten_phim        String      @db.VarChar(255)
  trailer         String?     @db.VarChar(500)
  hinh_anh        String?     @db.VarChar(500)
  mo_ta           String?     @db.Text
  ngay_khoi_chieu DateTime?   @db.Date
  danh_gia        Int?        @default(0)
  hot             Boolean?    @default(false)
  dang_chieu      Boolean?    @default(false)
  sap_chieu       Boolean?    @default(false)
  created_at      DateTime?   @default(now()) @db.Timestamp(0)
  updated_at      DateTime?   @default(now()) @db.Timestamp(0)
  Banner          Banner[]
  LichChieu       LichChieu[]

  @@index([dang_chieu], map: "idx_phim_dang_chieu")
  @@index([ngay_khoi_chieu], map: "idx_phim_ngay_khoi_chieu")
  @@index([sap_chieu], map: "idx_phim_sap_chieu")
}

model HeThongRap {
  ma_he_thong_rap  Int       @id @default(autoincrement())
  ten_he_thong_rap String    @db.VarChar(255)
  logo             String?   @db.VarChar(500)
  created_at       DateTime? @default(now()) @db.Timestamp(0)
  updated_at       DateTime? @default(now()) @db.Timestamp(0)
  CumRap           CumRap[]

  @@map("HeThongRap")
}

model CumRap {
  ma_cum_rap      Int        @id @default(autoincrement())
  ten_cum_rap     String     @db.VarChar(255)
  dia_chi         String?    @db.VarChar(500)
  ma_he_thong_rap Int
  created_at      DateTime?  @default(now()) @db.Timestamp(0)
  updated_at      DateTime?  @default(now()) @db.Timestamp(0)
  HeThongRap      HeThongRap @relation(fields: [ma_he_thong_rap], references: [ma_he_thong_rap], onDelete: Cascade, onUpdate: NoAction, map: "CumRap_ibfk_1")
  RapPhim         RapPhim[]

  @@index([ma_he_thong_rap], map: "ma_he_thong_rap")
  @@map("CumRap")
}

model RapPhim {
  ma_rap     Int         @id @default(autoincrement())
  ten_rap    String      @db.VarChar(255)
  ma_cum_rap Int
  created_at DateTime?   @default(now()) @db.Timestamp(0)
  updated_at DateTime?   @default(now()) @db.Timestamp(0)
  Ghe        Ghe[]
  LichChieu  LichChieu[]
  CumRap     CumRap      @relation(fields: [ma_cum_rap], references: [ma_cum_rap], onDelete: Cascade, onUpdate: NoAction, map: "RapPhim_ibfk_1")

  @@index([ma_cum_rap], map: "ma_cum_rap")
  @@map("RapPhim")
}

model NguoiDung {
  tai_khoan       Int       @id @default(autoincrement())
  ho_ten          String    @db.VarChar(255)
  email           String    @unique(map: "email") @db.VarChar(255)
  so_dt           String?   @db.VarChar(20)
  mat_khau        String    @db.VarChar(255)
  loai_nguoi_dung String?   @default("KhachHang") @db.VarChar(50)
  created_at      DateTime? @default(now()) @db.Timestamp(0)
  updated_at      DateTime? @default(now()) @db.Timestamp(0)
  DatVe           DatVe[]

  @@index([email], map: "idx_nguoi_dung_email")
  @@map("NguoiDung")
}

model LichChieu {
  ma_lich_chieu  Int       @id @default(autoincrement())
  ma_rap         Int
  ma_phim        Int
  ngay_gio_chieu DateTime  @db.DateTime(0)
  gia_ve         Decimal   @db.Decimal(10, 2)
  created_at     DateTime? @default(now()) @db.Timestamp(0)
  updated_at     DateTime? @default(now()) @db.Timestamp(0)
  DatVe          DatVe[]
  RapPhim        RapPhim   @relation(fields: [ma_rap], references: [ma_rap], onDelete: Cascade, onUpdate: NoAction, map: "LichChieu_ibfk_1")
  Phim           Phim      @relation(fields: [ma_phim], references: [ma_phim], onDelete: Cascade, onUpdate: NoAction, map: "LichChieu_ibfk_2")

  @@index([ngay_gio_chieu], map: "idx_lich_chieu_ngay_gio")
  @@index([ma_phim], map: "ma_phim")
  @@index([ma_rap], map: "ma_rap")
  @@map("LichChieu")
}

model Ghe {
  ma_ghe     Int       @id @default(autoincrement())
  ten_ghe    String    @db.VarChar(50)
  loai_ghe   String?   @default("Thuong") @db.VarChar(50)
  ma_rap     Int
  created_at DateTime? @default(now()) @db.Timestamp(0)
  updated_at DateTime? @default(now()) @db.Timestamp(0)
  DatVe      DatVe[]
  RapPhim    RapPhim   @relation(fields: [ma_rap], references: [ma_rap], onDelete: Cascade, onUpdate: NoAction, map: "Ghe_ibfk_1")

  @@index([ma_rap], map: "ma_rap")
  @@map("Ghe")
}

model DatVe {
  tai_khoan     Int
  ma_lich_chieu Int
  ma_ghe        Int
  ngay_dat_ve   DateTime? @default(now()) @db.Timestamp(0)
  trang_thai    String?   @default("DaDat") @db.VarChar(50)
  created_at    DateTime? @default(now()) @db.Timestamp(0)
  updated_at    DateTime? @default(now()) @db.Timestamp(0)
  NguoiDung     NguoiDung @relation(fields: [tai_khoan], references: [tai_khoan], onDelete: Cascade, onUpdate: NoAction, map: "DatVe_ibfk_1")
  LichChieu     LichChieu @relation(fields: [ma_lich_chieu], references: [ma_lich_chieu], onDelete: Cascade, onUpdate: NoAction, map: "DatVe_ibfk_2")
  Ghe           Ghe       @relation(fields: [ma_ghe], references: [ma_ghe], onDelete: Cascade, onUpdate: NoAction, map: "DatVe_ibfk_3")

  @@id([tai_khoan, ma_lich_chieu, ma_ghe])
  @@index([ngay_dat_ve], map: "idx_dat_ve_ngay_dat")
  @@index([ma_ghe], map: "ma_ghe")
  @@index([ma_lich_chieu], map: "ma_lich_chieu")
  @@map("DatVe")
}
